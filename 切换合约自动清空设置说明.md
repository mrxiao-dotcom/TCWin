# 切换合约自动清空设置说明

## 🚨 问题描述

### **用户反馈的问题**
当用户切换合约（Symbol）时，数量栏没有自动清空，导致：
1. **自动计算干扰**：旧的数量会触发止损金额的自动计算
2. **用户体验差**：无法方便地为新合约设置参数
3. **操作不便**：需要手动清空各项设置

### **具体场景**
```
1. 用户在BTCUSDT中设置了数量=0.001，止损比例=5%
2. 切换到ETHUSDT合约
3. 问题：数量仍然是0.001，自动计算出止损金额
4. 影响：用户无法干净地为ETHUSDT设置新参数
```

## ✅ 解决方案

### **实现逻辑**
在`OnSymbolChanged`方法中添加自动清空逻辑：

```csharp
// 切换合约时，清空相关数量和止损设置，避免自动计算干扰用户操作
if (!string.IsNullOrEmpty(value))
{
    Console.WriteLine($"🔄 切换合约到 {value}，清空数量和止损设置");
    
    // 清空数量
    Quantity = 0;
    
    // 清空止损相关设置
    StopLossRatio = 0;
    StopLossPrice = 0;
    StopLossAmount = 0;
    
    Console.WriteLine("✅ 已清空数量和止损设置，用户可重新输入");
}
```

### **清空的项目**
1. **Quantity** = 0：数量清零
2. **StopLossRatio** = 0：止损比例清零
3. **StopLossPrice** = 0：止损价格清零
4. **StopLossAmount** = 0：止损金额清零

### **保留的项目**
- **Side**：买卖方向（用户可能习惯性选择）
- **OrderType**：订单类型（用户可能有偏好）
- **Leverage**：杠杆（会在查询合约信息时自动调整）
- **PositionSide**：仓位方向
- **WorkingType**：触发方式

## 🎯 用户体验改进

### **改进前**
```
1. 在BTCUSDT设置: 数量=0.001, 止损=5%
2. 切换到ETHUSDT
3. 界面显示: 数量=0.001, 止损价=140, 止损金额=2.8
4. 用户需要手动清空所有设置 ❌
```

### **改进后**
```
1. 在BTCUSDT设置: 数量=0.001, 止损=5%
2. 切换到ETHUSDT
3. 界面显示: 数量=0, 止损比例=0%, 止损价=0, 止损金额=0
4. 用户可以直接输入新的设置 ✅
```

## 📋 交互流程

### **切换合约的完整流程**
1. **用户输入新合约**: 例如从BTCUSDT改为ETHUSDT
2. **自动补齐USDT**: 如果只输入ETH，自动补齐为ETHUSDT
3. **清空设置**: 自动清空数量和止损相关设置
4. **更新价格**: 获取新合约的最新价格
5. **用户重新设置**: 用户为新合约输入参数

### **日志输出示例**
```
🔄 切换合约到 ETHUSDT，清空数量和止损设置
✅ 已清空数量和止损设置，用户可重新输入
📊 开始获取 ETHUSDT 的最新价格...
✅ ETHUSDT 价格更新: 2800.25
```

## 🔧 技术实现

### **触发时机**
- **Symbol属性变化**: 当用户修改合约名称时
- **非空检查**: 只有当新合约名不为空时才清空
- **避免重复**: 在自动补齐等情况下避免重复触发

### **执行顺序**
1. 自动补齐USDT后缀（如需要）
2. 清空数量和止损设置
3. 更新最新价格
4. 通知UI更新

### **兼容性**
- ✅ 保持原有的自动补齐功能
- ✅ 保持原有的价格更新机制
- ✅ 不影响其他功能的正常运行

## 💡 使用建议

### **用户操作建议**
1. **切换合约后**：检查杠杆设置是否合适
2. **重新设置**：输入新合约的交易数量
3. **设置止损**：根据新合约特点设置止损比例
4. **确认参数**：下单前再次确认所有参数

### **开发者注意事项**
- 清空操作不会触发额外的计算
- 用户可以立即开始输入新的参数
- 保持了界面的响应性和流畅性

这个改进让用户在切换不同合约时有更干净的操作环境，避免了旧设置的干扰。 