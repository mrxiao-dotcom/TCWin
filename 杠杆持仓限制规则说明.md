# 杠杆持仓限制规则说明

## 🚨 界面卡死问题修复

### **问题原因**
在`ValidateStopLossPrice`方法中使用了同步调用：
```csharp
basePrice = GetLatestPriceAsync(request.Symbol).Result;  // ❌ 死锁风险
```

### **修复方案**
将方法改为异步：
```csharp
private async Task<(bool isValid, string errorMessage)> ValidateStopLossPriceAsync(OrderRequest request)
{
    // 异步获取当前价格用于计算
    basePrice = await GetLatestPriceAsync(request.Symbol);  // ✅ 正确的异步调用
}
```

**结果**：彻底解决了下单时界面卡死的问题。

---

## 📊 杠杆下的基础持仓限制规则

### **🪙 主流币种限制**

#### **BTCUSDT (比特币)**
| 杠杆倍数 | 最大持仓数量 | 说明 |
|---------|-------------|------|
| ≤ 20x   | 100 BTC     | 推荐杠杆 |
| 21-50x  | 50 BTC      | 中等风险 |
| 51-125x | 5 BTC       | 高风险 |
| > 125x  | 1 BTC       | 极高风险 |

#### **ETHUSDT (以太坊)**
| 杠杆倍数 | 最大持仓数量 | 说明 |
|---------|-------------|------|
| ≤ 25x   | 1000 ETH    | 推荐杠杆 |
| 26-50x  | 500 ETH     | 中等风险 |
| 51-100x | 100 ETH     | 高风险 |
| > 100x  | 50 ETH      | 极高风险 |

### **🔹 中价币种限制**

#### **ADAUSDT (艾达币)**
| 杠杆倍数 | 最大持仓数量 | 说明 |
|---------|-------------|------|
| ≤ 25x   | 500,000 ADA | 推荐杠杆 |
| 26-50x  | 250,000 ADA | 中等风险 |
| 51-75x  | 100,000 ADA | 高风险 |
| > 75x   | 50,000 ADA  | 极高风险 |

#### **DOGEUSDT (狗狗币)**
| 杠杆倍数 | 最大持仓数量 | 说明 |
|---------|-------------|------|
| ≤ 25x   | 2,000,000 DOGE | 推荐杠杆 |
| 26-50x  | 1,000,000 DOGE | 中等风险 |
| > 50x   | 500,000 DOGE   | 高风险 |

### **🔸 小币种特殊限制**

#### **AIOTUSDT (专用规则)**
| 杠杆倍数 | 最大持仓数量 | 备注 |
|---------|-------------|------|
| ≤ 3x    | 50,000 AIOT | **根据实际-2027错误调整** |
| 4-10x   | 20,000 AIOT | 保守限制 |
| 11-20x  | 10,000 AIOT | 中等风险 |
| 21-50x  | 5,000 AIOT  | 高风险 |
| > 50x   | 1,000 AIOT  | 极高风险 |

#### **B2USDT**
| 杠杆倍数 | 最大持仓数量 | 备注 |
|---------|-------------|------|
| ≤ 10x   | 50,000 B2   | 推荐杠杆 |
| 11-20x  | 25,000 B2   | 中等风险 |
| 21-50x  | 10,000 B2   | 高风险 |
| > 50x   | 5,000 B2    | 极高风险 |

### **🎯 通用小币种规则 (价格 < $1)**

| 杠杆倍数 | 最大持仓数量 | 适用范围 |
|---------|-------------|----------|
| ≤ 3x    | 50,000      | 超低价币 |
| 4-10x   | 25,000      | 推荐设置 |
| 11-20x  | 10,000      | 中等风险 |
| 21-50x  | 5,000       | 高风险 |
| > 50x   | 1,000       | 极高风险 |

### **📈 默认规则 (未列出的币种)**

| 杠杆倍数 | 最大持仓数量 | 说明 |
|---------|-------------|------|
| ≤ 20x   | 100,000     | 通用限制 |
| 21-50x  | 50,000      | 中等风险 |
| > 50x   | 10,000      | 高风险 |

---

## 🔧 动态限制机制

### **名义价值限制**
对于价格 < $1 的币种，还会应用名义价值限制：
```
最大名义价值 = $50,000
数量限制 = min(基础限制, $50,000 ÷ 当前价格)
```

### **示例计算**
```
AIOTUSDT, 价格 = $0.30, 杠杆 = 3x
基础限制 = 50,000
名义价值限制 = $50,000 ÷ $0.30 = 166,667
最终限制 = min(50,000, 166,667) = 50,000
```

---

## ⚠️ 重要提醒

### **实际应用注意事项**
1. **实时调整**：币安会根据市场情况动态调整限制
2. **保守设置**：建议使用比最大限制更小的持仓
3. **-2027错误**：当遇到此错误时，应降低杠杆或减少数量
4. **测试验证**：新币种建议小额测试后再增加仓位

### **建议操作流程**
1. **选择合约** → 查看对应的持仓限制表
2. **设置杠杆** → 根据限制选择合适杠杆
3. **计算数量** → 确保不超过最大持仓限制
4. **小额测试** → 新币种先小额测试
5. **逐步增加** → 确认无问题后再增加仓位

这个规则表会根据实际使用情况和币安政策更新持续优化。 