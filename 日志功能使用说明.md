# 📄 TCWin 日志功能使用说明

## 🎯 功能概述

为了帮助调试"选定订单下保本止损失败"等问题，我们添加了完整的文件日志功能。现在所有操作都会同时输出到控制台和日志文件，方便排查问题。

## 📁 日志文件位置

日志文件自动保存在项目根目录：`trading_log.txt`

完整路径示例：`D:\CSharpProjects\TCWin\trading_log.txt`

## 🔧 使用方法

### 1. 查看日志文件
- **界面按钮**：点击顶部工具栏的"查看日志"按钮
- **手动方式**：直接打开项目根目录下的 `trading_log.txt` 文件

### 2. 清空日志文件
- **界面按钮**：点击顶部工具栏的"清空日志"按钮
- **确认操作**：系统会询问确认，点击"是"清空日志

### 3. 日志内容说明

日志文件包含详细的操作记录，格式如下：
```
[2024-01-XX HH:mm:ss.fff] 🛡️ 开始为选中订单添加保本止损...
[2024-01-XX HH:mm:ss.fff] 🔧 调试: 选中订单数量: 2
[2024-01-XX HH:mm:ss.fff] 🔧 调试: 有效限价单数量: 2
[2024-01-XX HH:mm:ss.fff] 🔧 调试: 有效订单: 123456 BTCUSDT BUY 0.001 @ 45000.0
[2024-01-XX HH:mm:ss.fff] ℹ️ 信息: 开始处理 2 个有效订单...
[2024-01-XX HH:mm:ss.fff] ℹ️ 信息: 🛡️ 为订单添加保本止损: OrderId=123456, Symbol=BTCUSDT, Side=BUY, Price=45000.0
[2024-01-XX HH:mm:ss.fff] 🔧 调试: 止损单参数: Symbol=BTCUSDT, Side=SELL, Type=STOP_MARKET, Quantity=0.001, StopPrice=45000.0, ReduceOnly=True
[2024-01-XX HH:mm:ss.fff] ❌ 错误: API错误: Code=-2019, Message=Margin is insufficient.
[2024-01-XX HH:mm:ss.fff] ℹ️ 信息: 建议: 请检查账户余额，确保有足够的保证金支持新订单
```

## 🔍 日志类型说明

| 图标 | 类型 | 说明 |
|------|------|------|
| ℹ️ | 信息 | 一般操作信息 |
| ✅ | 成功 | 操作成功 |
| ⚠️ | 警告 | 需要注意的情况 |
| ❌ | 错误 | 操作失败或异常 |
| 🔧 | 调试 | 详细的调试信息 |

## 🐛 调试保本止损问题

当"选定订单下保本止损"失败时，请按以下步骤调试：

### 1. 操作步骤
1. 选择要添加保本止损的订单（勾选左侧复选框）
2. 点击"批量保本止损"按钮
3. 确认对话框
4. 如果失败，立即查看日志

### 2. 查看日志
1. 点击"查看日志"按钮
2. 滚动到日志文件末尾
3. 找到最近的保本止损相关记录

### 3. 常见错误及解决方案

#### 错误：`Margin is insufficient`
- **原因**：保证金不足
- **解决**：增加账户余额或减少持仓数量

#### 错误：`Order would immediately trigger`
- **原因**：止损价格设置不合理，会立即触发
- **解决**：检查当前价格与止损价格的关系

#### 错误：`Invalid symbol`
- **原因**：合约名称无效
- **解决**：确认合约名称正确（如：BTCUSDT）

#### 错误：`LOT_SIZE`
- **原因**：数量不符合最小交易单位
- **解决**：调整订单数量

## 💡 高级技巧

### 1. 实时监控
- 日志文件会实时更新
- 可以使用文本编辑器（如记事本、VS Code）打开日志文件
- 某些编辑器支持自动刷新功能

### 2. 日志搜索
在日志文件中搜索关键词：
- `保本止损` - 找到所有保本止损相关操作
- `错误` - 找到所有错误信息
- `OrderId=123456` - 找到特定订单的操作记录
- `BTCUSDT` - 找到特定币种的操作

### 3. 性能优化
- 定期清空日志文件（建议每周一次）
- 大文件可能影响程序性能
- 重要日志可以备份到其他位置

## 🔄 日志轮转

当日志文件过大时（建议超过10MB时）：
1. 点击"清空日志"按钮，或
2. 手动重命名现有日志文件为 `trading_log_backup_YYYYMMDD.txt`
3. 重新启动程序会自动创建新的日志文件

## 📞 技术支持

如果日志功能有问题：
1. 检查项目目录的写权限
2. 确认没有其他程序占用日志文件
3. 查看日志文件是否正常生成和更新

---

**注意**：日志文件包含详细的操作信息，请妥善保管，避免泄露敏感信息。 