# è´¦æˆ·é…ç½®æŒ‰é’®ä¿®å¤è¯´æ˜

## é—®é¢˜æè¿°

**ç”¨æˆ·åé¦ˆ**: "ä¿®æ”¹é…ç½®å’Œè´¦æˆ·é…ç½®æŒ‰é’®å¤±æ•ˆäº†"

**é—®é¢˜åˆ†æ**: 
- åœ¨`ViewModels/MainViewModel.Data.cs`ä¸­çš„`ConfigureAccountCommand`å’Œ`EditCurrentAccountCommand`å‘½ä»¤åªæ˜¯æ˜¾ç¤ºçŠ¶æ€æ¶ˆæ¯
- æ²¡æœ‰å®é™…æ‰“å¼€è´¦æˆ·é…ç½®çª—å£
- è¿™äº›æ˜¯å ä½ç¬¦ä»£ç ï¼Œç¼ºå°‘çœŸæ­£çš„çª—å£åˆ›å»ºå’Œæ˜¾ç¤ºé€»è¾‘

## è§£å†³æ–¹æ¡ˆ

### ğŸ”§ ä¾èµ–æ³¨å…¥æ¶æ„ä¼˜åŒ–

#### 1. æ³¨å†Œçª—å£æœåŠ¡
åœ¨`ServiceConfiguration.cs`ä¸­æ·»åŠ AccountConfigWindowçš„æ³¨å†Œï¼š

```csharp
// æ³¨å†Œçª—å£ï¼ˆç¬æ€æ¨¡å¼ï¼‰
services.AddTransient<MainWindow>();
services.AddTransient<Views.AccountConfigWindow>();
```

#### 2. MainViewModelä¾èµ–æ³¨å…¥å¢å¼º
ä¸ºMainViewModelæ·»åŠ IServiceProviderä¾èµ–ï¼Œç”¨äºåˆ›å»ºçª—å£å®ä¾‹ï¼š

```csharp
#region æœåŠ¡ä¾èµ–
private readonly IServiceProvider _serviceProvider;
#endregion

// æ„é€ å‡½æ•°å‚æ•°æ·»åŠ 
public MainViewModel(
    // ... å…¶ä»–å‚æ•°
    IServiceProvider serviceProvider)
{
    _serviceProvider = serviceProvider;
}
```

### ğŸ“ å‘½ä»¤å®ç°ä¿®å¤

#### 1. ConfigureAccountå‘½ä»¤ - æ–°å»ºè´¦æˆ·é…ç½®
```csharp
[RelayCommand]
private void ConfigureAccount()
{
    try
    {
        // é€šè¿‡ä¾èµ–æ³¨å…¥è·å–çª—å£å’ŒViewModel
        var accountConfigViewModel = _serviceProvider.GetRequiredService<AccountConfigViewModel>();
        var accountConfigWindow = _serviceProvider.GetRequiredService<Views.AccountConfigWindow>();
        
        // è®¾ç½®çª—å£DataContextå’Œæ‰€æœ‰è€…
        accountConfigWindow.DataContext = accountConfigViewModel;
        accountConfigWindow.Owner = System.Windows.Application.Current.MainWindow;
        
        // æ˜¾ç¤ºæ¨¡æ€å¯¹è¯æ¡†
        var result = accountConfigWindow.ShowDialog();
        
        if (result == true)
        {
            // ä¿å­˜æˆåŠŸï¼Œé‡æ–°åŠ è½½è´¦æˆ·åˆ—è¡¨
            LoadAccounts();
            StatusMessage = "è´¦æˆ·é…ç½®å·²ä¿å­˜å¹¶æ›´æ–°";
        }
        else
        {
            StatusMessage = "è´¦æˆ·é…ç½®å·²å–æ¶ˆ";
        }
    }
    catch (Exception ex)
    {
        _logger.LogError(ex, "æ‰“å¼€è´¦æˆ·é…ç½®å¤±è´¥");
        StatusMessage = $"æ‰“å¼€è´¦æˆ·é…ç½®å¤±è´¥: {ex.Message}";
    }
}
```

#### 2. EditCurrentAccountå‘½ä»¤ - ç¼–è¾‘å½“å‰è´¦æˆ·
```csharp
[RelayCommand]
private void EditCurrentAccount()
{
    if (SelectedAccount == null)
    {
        StatusMessage = "è¯·å…ˆé€‰æ‹©è´¦æˆ·";
        return;
    }

    try
    {
        // åˆ›å»ºé¢„å¡«å……å½“å‰è´¦æˆ·æ•°æ®çš„ViewModel
        var accountConfigViewModel = new AccountConfigViewModel(_accountService, SelectedAccount);
        var accountConfigWindow = _serviceProvider.GetRequiredService<Views.AccountConfigWindow>();
        
        accountConfigWindow.DataContext = accountConfigViewModel;
        accountConfigWindow.Owner = System.Windows.Application.Current.MainWindow;
        
        var result = accountConfigWindow.ShowDialog();
        
        if (result == true)
        {
            LoadAccounts();
            
            // é‡æ–°é€‰æ‹©æ›´æ–°åçš„è´¦æˆ·
            var updatedAccount = Accounts.FirstOrDefault(a => a.Name == SelectedAccount.Name);
            if (updatedAccount != null)
            {
                SelectedAccount = updatedAccount;
            }
            
            StatusMessage = $"è´¦æˆ· {SelectedAccount.Name} é…ç½®å·²æ›´æ–°";
        }
        else
        {
            StatusMessage = "å–æ¶ˆç¼–è¾‘è´¦æˆ·é…ç½®";
        }
    }
    catch (Exception ex)
    {
        _logger.LogError(ex, "ç¼–è¾‘è´¦æˆ·å¤±è´¥");
        StatusMessage = $"ç¼–è¾‘è´¦æˆ·å¤±è´¥: {ex.Message}";
    }
}
```

## æŠ€æœ¯ç»†èŠ‚

### ğŸ¯ å…³é”®æ”¹è¿›ç‚¹

#### 1. ä¾èµ–æ³¨å…¥é›†æˆ
- åˆ©ç”¨WPFåº”ç”¨ç¨‹åºçš„ä¾èµ–æ³¨å…¥å®¹å™¨
- é€šè¿‡`IServiceProvider.GetRequiredService<T>()`è·å–æœåŠ¡å®ä¾‹
- ç¡®ä¿çª—å£å’ŒViewModelçš„æ­£ç¡®ç”Ÿå‘½å‘¨æœŸç®¡ç†

#### 2. çª—å£æ‰€æœ‰è€…è®¾ç½®
```csharp
accountConfigWindow.Owner = System.Windows.Application.Current.MainWindow;
```
- ç¡®ä¿å¯¹è¯æ¡†æ˜¾ç¤ºåœ¨ä¸»çª—å£ä¹‹ä¸Š
- æä¾›æ­£ç¡®çš„æ¨¡æ€è¡Œä¸º
- é˜²æ­¢ç”¨æˆ·åœ¨é…ç½®æ—¶æ“ä½œä¸»çª—å£

#### 3. æ¨¡æ€å¯¹è¯æ¡†æ¨¡å¼
```csharp
var result = accountConfigWindow.ShowDialog();
if (result == true) { /* ä¿å­˜é€»è¾‘ */ }
```
- é˜»å¡UIç›´åˆ°ç”¨æˆ·å®Œæˆé…ç½®
- é€šè¿‡è¿”å›å€¼åˆ¤æ–­ç”¨æˆ·æ˜¯ä¿å­˜è¿˜æ˜¯å–æ¶ˆ
- æ ¹æ®ç»“æœæ‰§è¡Œç›¸åº”çš„åç»­æ“ä½œ

#### 4. æ•°æ®åŒæ­¥æœºåˆ¶
- **æ–°å»ºé…ç½®**: è°ƒç”¨`LoadAccounts()`é‡æ–°åŠ è½½æ‰€æœ‰è´¦æˆ·
- **ç¼–è¾‘é…ç½®**: ä¿æŒå½“å‰é€‰æ‹©ï¼Œæ›´æ–°è´¦æˆ·å¯¹è±¡å¼•ç”¨
- **çŠ¶æ€åé¦ˆ**: é€šè¿‡StatusMessageæä¾›ç”¨æˆ·æ“ä½œåé¦ˆ

### ğŸ”„ ViewModelæ„é€ å‡½æ•°é‡è½½
AccountConfigViewModelæ”¯æŒä¸¤ç§åˆ›å»ºæ–¹å¼ï¼š

```csharp
// æ–°å»ºè´¦æˆ·é…ç½®
var viewModel = _serviceProvider.GetRequiredService<AccountConfigViewModel>();

// ç¼–è¾‘ç°æœ‰è´¦æˆ·é…ç½®  
var viewModel = new AccountConfigViewModel(_accountService, SelectedAccount);
```

### ğŸ“‹ é”™è¯¯å¤„ç†
- å®Œæ•´çš„try-catchå¼‚å¸¸å¤„ç†
- è¯¦ç»†çš„æ—¥å¿—è®°å½•
- ç”¨æˆ·å‹å¥½çš„é”™è¯¯æ¶ˆæ¯æ˜¾ç¤º
- ç¡®ä¿å¼‚å¸¸ä¸ä¼šå¯¼è‡´åº”ç”¨ç¨‹åºå´©æºƒ

## ç”¨æˆ·ä½“éªŒæ”¹è¿›

### âœ… åŠŸèƒ½æ¢å¤
- âœ… **è´¦æˆ·é…ç½®æŒ‰é’®**: å¯ä»¥æ–°å»ºè´¦æˆ·é…ç½®
- âœ… **ä¿®æ”¹è´¦æˆ·æŒ‰é’®**: å¯ä»¥ç¼–è¾‘å½“å‰é€‰æ‹©çš„è´¦æˆ·
- âœ… **æ¨¡æ€çª—å£**: æ­£ç¡®çš„å¯¹è¯æ¡†è¡Œä¸º
- âœ… **æ•°æ®åŒæ­¥**: é…ç½®ä¿å­˜åè‡ªåŠ¨æ›´æ–°ç•Œé¢

### ğŸ¨ äº¤äº’ä½“éªŒ
- ğŸ”„ **å³æ—¶åé¦ˆ**: æ“ä½œçŠ¶æ€é€šè¿‡StatusMessageæ˜¾ç¤º
- ğŸ“ **æ•°æ®ä¿æŒ**: ç¼–è¾‘åä¿æŒå½“å‰è´¦æˆ·é€‰æ‹©
- âš ï¸ **è¾“å…¥éªŒè¯**: æœªé€‰æ‹©è´¦æˆ·æ—¶çš„å‹å¥½æç¤º
- ğŸš« **é”™è¯¯å¤„ç†**: å¼‚å¸¸æƒ…å†µçš„ä¼˜é›…å¤„ç†

### ğŸ›¡ï¸ å®‰å…¨æ€§
- ğŸ”’ **æ¨¡æ€æ“ä½œ**: é˜²æ­¢é…ç½®è¿‡ç¨‹ä¸­çš„æ„å¤–æ“ä½œ
- ğŸ’¾ **æ•°æ®ä¸€è‡´æ€§**: ç¡®ä¿é…ç½®ä¿å­˜åçš„çŠ¶æ€åŒæ­¥
- ğŸ“Š **æ—¥å¿—è®°å½•**: ä¾¿äºé—®é¢˜è¿½è¸ªå’Œè°ƒè¯•

## ç›¸å…³æ–‡ä»¶å˜æ›´

### æ–°å¢/ä¿®æ”¹æ–‡ä»¶
1. **ServiceConfiguration.cs** - æ·»åŠ AccountConfigWindowæ³¨å†Œ
2. **ViewModels/MainViewModel.Core.cs** - æ·»åŠ IServiceProviderä¾èµ–
3. **ViewModels/MainViewModel.Data.cs** - å®ç°çœŸæ­£çš„å‘½ä»¤åŠŸèƒ½

### ä¾èµ–å…³ç³»
```
MainViewModel 
â”œâ”€â”€ IServiceProvider (åˆ›å»ºçª—å£)
â”œâ”€â”€ AccountConfigService (è´¦æˆ·æ•°æ®)
â””â”€â”€ Views.AccountConfigWindow (é…ç½®çª—å£)
    â””â”€â”€ AccountConfigViewModel (çª—å£é€»è¾‘)
```

## æµ‹è¯•éªŒè¯

### ğŸ§ª æµ‹è¯•åœºæ™¯
1. **æ–°å»ºè´¦æˆ·é…ç½®**
   - ç‚¹å‡»"è´¦æˆ·é…ç½®"æŒ‰é’® â†’ æ‰“å¼€ç©ºç™½é…ç½®çª—å£
   - å¡«å†™ä¿¡æ¯å¹¶ä¿å­˜ â†’ è´¦æˆ·åˆ—è¡¨æ›´æ–°
   - å–æ¶ˆæ“ä½œ â†’ çŠ¶æ€æç¤º"å·²å–æ¶ˆ"

2. **ç¼–è¾‘ç°æœ‰è´¦æˆ·**
   - é€‰æ‹©è´¦æˆ· â†’ ç‚¹å‡»"ä¿®æ”¹è´¦æˆ·" â†’ æ‰“å¼€é¢„å¡«å……çª—å£
   - ä¿®æ”¹ä¿¡æ¯å¹¶ä¿å­˜ â†’ å½“å‰è´¦æˆ·ä¿æŒé€‰æ‹©ï¼Œæ•°æ®æ›´æ–°
   - å–æ¶ˆæ“ä½œ â†’ ä¿æŒåŸæœ‰æ•°æ®

3. **å¼‚å¸¸å¤„ç†**
   - æœªé€‰æ‹©è´¦æˆ·ç¼–è¾‘ â†’ æç¤º"è¯·å…ˆé€‰æ‹©è´¦æˆ·"
   - çª—å£åˆ›å»ºå¤±è´¥ â†’ é”™è¯¯æ¶ˆæ¯æ˜¾ç¤º

### ğŸ“Š éªŒè¯é‡ç‚¹
- âœ… æŒ‰é’®å¯ä»¥æ­£å¸¸ç‚¹å‡»
- âœ… çª—å£æ­£ç¡®æ‰“å¼€å’Œæ˜¾ç¤º
- âœ… æ•°æ®ä¿å­˜å’ŒåŠ è½½æ­£å¸¸
- âœ… çŠ¶æ€æ¶ˆæ¯å‡†ç¡®åé¦ˆ
- âœ… å¼‚å¸¸æƒ…å†µå¦¥å–„å¤„ç†

## æ€»ç»“

æœ¬æ¬¡ä¿®å¤é€šè¿‡å®Œå–„çš„**ä¾èµ–æ³¨å…¥æ¶æ„**å’Œ**æ¨¡æ€çª—å£æœºåˆ¶**ï¼ŒæˆåŠŸæ¢å¤äº†è´¦æˆ·é…ç½®åŠŸèƒ½ã€‚ç”¨æˆ·ç°åœ¨å¯ä»¥ï¼š

1. âœ… æ­£å¸¸ä½¿ç”¨"è´¦æˆ·é…ç½®"æŒ‰é’®æ–°å»ºè´¦æˆ·
2. âœ… é€šè¿‡"ä¿®æ”¹è´¦æˆ·"æŒ‰é’®ç¼–è¾‘ç°æœ‰è´¦æˆ·  
3. âœ… äº«å—æµç•…çš„é…ç½®ä½“éªŒå’Œå‡†ç¡®çš„çŠ¶æ€åé¦ˆ

è¿™ä¸ªä¿®å¤ä¸ä»…è§£å†³äº†æŒ‰é’®å¤±æ•ˆé—®é¢˜ï¼Œè¿˜æå‡äº†æ•´ä½“çš„ç”¨æˆ·ä½“éªŒå’Œä»£ç çš„å¯ç»´æŠ¤æ€§ã€‚ 