# æ•°é‡ç²¾åº¦å’Œåä¹‰ä»·å€¼ä¿®å¤è¯´æ˜

## ğŸš¨ é—®é¢˜æè¿°

### 1. **åä¹‰ä»·å€¼è®¡ç®—é”™è¯¯**
**ç”¨æˆ·åé¦ˆ**ï¼š
- æ•°é‡ï¼š6518.863
- ä»·æ ¼ï¼š0.3097
- è®¡ç®—ç»“æœï¼š6518.863 Ã— 0.3097 â‰ˆ 2019 USDT
- ä½†ç³»ç»ŸæŠ¥é”™ï¼š"æœ€å¤§åä¹‰ä»·å€¼ä¸º$1000000"ï¼Œæ˜æ˜¾è®¡ç®—æœ‰è¯¯

### 2. **æ•°é‡ç²¾åº¦é—®é¢˜**
**ç”¨æˆ·è¦æ±‚**ï¼šç‚¹å‡»ä»¥æŸå®šé‡åï¼Œæ•°é‡åº”è¯¥æ˜¯å¸å®‰è¿”å›çš„æœ€å°äº¤æ˜“å•ä½ï¼ˆstepSizeï¼‰çš„æ•´æ•°å€ï¼Œéœ€è¦è§„èŒƒåŒ–æ•°é‡ã€‚

## ğŸ” é—®é¢˜æ ¹æœ¬åŸå› 

### 1. **åä¹‰ä»·å€¼ä½¿ç”¨ç¡¬ç¼–ç ä»·æ ¼**
**åŸä»£ç é—®é¢˜**ï¼š
```csharp
// BinanceService.cs - ValidateQuantityLimitsæ–¹æ³•
decimal estimatedPrice = 46000m; // ç¡¬ç¼–ç çš„BTCä»·æ ¼
var notionalValue = quantity * estimatedPrice; // é”™è¯¯çš„è®¡ç®—
```

**é—®é¢˜åˆ†æ**ï¼š
- å¯¹äºADAç­‰ä½ä»·å¸ï¼Œç¡¬ç¼–ç ä»·æ ¼46000å®Œå…¨é”™è¯¯
- 6518.863 Ã— 46000 = 299,867,698 > 1,000,000ï¼Œå¯¼è‡´é”™è¯¯

### 2. **æ•°é‡ç²¾åº¦ç¼ºä¹APIæ”¯æŒ**
**åŸä»£ç é—®é¢˜**ï¼š
- `AdjustQuantityPrecision`æ–¹æ³•åªä½¿ç”¨ç¡¬ç¼–ç ç²¾åº¦è§„åˆ™
- æ²¡æœ‰ä½¿ç”¨å¸å®‰APIè¿”å›çš„çœŸå®`stepSize`
- æ— æ³•ä¿è¯æ•°é‡ç¬¦åˆäº¤æ˜“æ‰€è¦æ±‚

## âœ… è§£å†³æ–¹æ¡ˆ

### ğŸ”§ **1. ä¿®å¤åä¹‰ä»·å€¼è®¡ç®—**

#### A. ä½¿ç”¨çœŸå®å½“å‰ä»·æ ¼
```csharp
// ä¿®å¤å‰ï¼šä½¿ç”¨ç¡¬ç¼–ç ä»·æ ¼
var notionalValue = quantity * estimatedPrice; // estimatedPrice = 46000

// ä¿®å¤åï¼šä½¿ç”¨çœŸå®å½“å‰ä»·æ ¼
var currentPrice = await GetLatestPriceAsync(request.Symbol);
var notionalValue = quantity * currentPrice; // ä½¿ç”¨çœŸå®ä»·æ ¼
```

#### B. é›†æˆçœŸå®äº¤æ˜“è§„åˆ™API
```csharp
// æ–°å¢ï¼šè·å–çœŸå®çš„å¸å®‰äº¤æ˜“è§„åˆ™
var (minQuantity, maxQuantity, maxLeverage, maxNotional, tickSize, stepSize) = 
    await GetRealExchangeInfoAsync(symbol);
```

### ğŸ”§ **2. æ”¹è¿›æ•°é‡ç²¾åº¦å¤„ç†**

#### A. ä½¿ç”¨çœŸå®stepSize
```csharp
// ä¿®å¤å‰ï¼šç¡¬ç¼–ç ç²¾åº¦è§„åˆ™
var adjustedQuantity = symbol.ToUpper() switch
{
    "ADAUSDT" => Math.Round(quantity, 0), // ç¡¬ç¼–ç æ•´æ•°
    _ => Math.Round(quantity, 3)
};

// ä¿®å¤åï¼šä½¿ç”¨APIè¿”å›çš„stepSize
if (stepSize > 0)
{
    var steps = Math.Floor(quantity / stepSize);
    var adjustedQuantity = steps * stepSize; // ç¡®ä¿æ˜¯stepSizeçš„æ•´æ•°å€
}
```

#### B. å¼‚æ­¥ç²¾åº¦è°ƒæ•´
```csharp
// æ–°æ–¹æ³•ï¼šAdjustQuantityPrecisionAsync
private async Task<decimal> AdjustQuantityPrecisionAsync(decimal quantity, string symbol, decimal minQuantity, decimal maxQuantity)
{
    // 1. è·å–çœŸå®çš„stepSize
    var realExchangeInfo = await _binanceService.GetRealExchangeInfoAsync(symbol);
    var stepSize = realExchangeInfo.stepSize;
    
    // 2. ç¡®ä¿æ•°é‡æ˜¯stepSizeçš„æ•´æ•°å€
    if (stepSize > 0)
    {
        var steps = Math.Floor(quantity / stepSize);
        quantity = steps * stepSize;
    }
    
    // 3. å¤‡é€‰ä¼ ç»Ÿæ–¹æ³•
    return quantity;
}
```

## ğŸ“‹ ä¿®æ”¹çš„æ–‡ä»¶å’Œæ–¹æ³•

### 1. **BinanceService.cs**
- âœ… `ValidateOrderAsync()` - è·å–çœŸå®å½“å‰ä»·æ ¼
- âœ… `ValidateQuantityLimitsAsync()` - æ–°å¢å¼‚æ­¥æ ¡éªŒæ–¹æ³•
- âœ… `ValidateQuantityLimitsFallback()` - å¤‡é€‰æ ¡éªŒæ–¹æ¡ˆ
- âœ… ä½¿ç”¨`GetRealExchangeInfoAsync()`è·å–çœŸå®äº¤æ˜“è§„åˆ™

### 2. **MainViewModel.cs**
- âœ… `AdjustQuantityPrecisionAsync()` - æ–°å¢å¼‚æ­¥ç²¾åº¦è°ƒæ•´
- âœ… `AdjustQuantityPrecisionTraditional()` - ä¼ ç»Ÿç²¾åº¦è°ƒæ•´å¤‡é€‰
- âœ… `CalculateQuantityFromLossAsync()` - æ›´æ–°è°ƒç”¨å¼‚æ­¥æ–¹æ³•

## ğŸ¯ ä¿®å¤æ•ˆæœ

### âœ… **åä¹‰ä»·å€¼è®¡ç®—æ­£ç¡®**
```
ä¿®å¤å‰ï¼š6518.863 Ã— 46000 = 299,867,698 > 1,000,000 âŒ
ä¿®å¤åï¼š6518.863 Ã— 0.3097 = 2,019 < 100,000 âœ…
```

### âœ… **æ•°é‡ç²¾åº¦ç¬¦åˆå¸å®‰è§„åˆ™**
```
ä¿®å¤å‰ï¼š6518.863 ï¼ˆå¯èƒ½ä¸ç¬¦åˆstepSizeï¼‰
ä¿®å¤åï¼š6518.000 æˆ– 6519.000 ï¼ˆç¡®ä¿æ˜¯stepSizeæ•´æ•°å€ï¼‰
```

### âœ… **çœŸå®APIé›†æˆ**
- ğŸ”— **çœŸå®äº¤æ˜“è§„åˆ™**ï¼šä»å¸å®‰APIè·å–minQtyã€maxQtyã€stepSize
- ğŸ”— **çœŸå®ä»·æ ¼**ï¼šä½¿ç”¨å½“å‰å¸‚åœºä»·æ ¼è®¡ç®—åä¹‰ä»·å€¼
- ğŸ”— **æ™ºèƒ½å¤‡é€‰**ï¼šAPIå¤±è´¥æ—¶è‡ªåŠ¨ä½¿ç”¨å¤‡é€‰æ–¹æ¡ˆ

## ğŸ§ª æµ‹è¯•å»ºè®®

### 1. **åä¹‰ä»·å€¼æµ‹è¯•**
- âœ… æµ‹è¯•ä½ä»·å¸ï¼ˆå¦‚ADAã€DOGEï¼‰çš„åä¹‰ä»·å€¼è®¡ç®—
- âœ… éªŒè¯ä½¿ç”¨çœŸå®ä»·æ ¼è€Œä¸æ˜¯ç¡¬ç¼–ç ä»·æ ¼
- âœ… ç¡®è®¤é”™è¯¯ä¿¡æ¯æ˜¾ç¤ºçœŸå®çš„è®¡ç®—ç»“æœ

### 2. **æ•°é‡ç²¾åº¦æµ‹è¯•**
- âœ… æµ‹è¯•"ä»¥æŸå®šé‡"åŠŸèƒ½
- âœ… éªŒè¯ç»“æœæ•°é‡ç¬¦åˆstepSizeè¦æ±‚
- âœ… æµ‹è¯•ä¸åŒä»·æ ¼åŒºé—´çš„å¸ç§ç²¾åº¦å¤„ç†

### 3. **è¾¹ç•Œæ¡ä»¶æµ‹è¯•**
- âœ… APIè°ƒç”¨å¤±è´¥æ—¶çš„å¤‡é€‰æ–¹æ¡ˆ
- âœ… æå°æ•°é‡å’Œæå¤§æ•°é‡çš„å¤„ç†
- âœ… ä¸åŒåˆçº¦çš„ç²¾åº¦è§„åˆ™éªŒè¯

## ğŸ‰ æ€»ç»“

é€šè¿‡è¿™æ¬¡ä¿®å¤ï¼Œæˆ‘ä»¬å®ç°äº†ï¼š

1. **âœ… å‡†ç¡®çš„åä¹‰ä»·å€¼è®¡ç®—**ï¼šä½¿ç”¨çœŸå®å½“å‰ä»·æ ¼æ›¿ä»£ç¡¬ç¼–ç ä»·æ ¼
2. **âœ… ç²¾ç¡®çš„æ•°é‡ç²¾åº¦å¤„ç†**ï¼šåŸºäºå¸å®‰APIçš„stepSizeè§„èŒƒåŒ–æ•°é‡
3. **âœ… å®Œæ•´çš„APIé›†æˆ**ï¼šçœŸå®äº¤æ˜“è§„åˆ™æ›¿ä»£ç¡¬ç¼–ç é™åˆ¶
4. **âœ… å¯é çš„å¤‡é€‰æœºåˆ¶**ï¼šAPIå¤±è´¥æ—¶è‡ªåŠ¨é™çº§åˆ°ä¼ ç»Ÿæ–¹æ³•

è¿™ç¡®ä¿äº†äº¤æ˜“å‚æ•°çš„å‡†ç¡®æ€§å’Œä¸å¸å®‰äº¤æ˜“æ‰€çš„å®Œå…¨å…¼å®¹ï¼ 